= RatingControl Sample
// --- D O N ' T    T O U C H   T H I S    S E C T I O N ---
:toc:
:toc-placement!:
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
// ----------------------------------------------------------



// Write a short summary here what this examples does
This example will show you how to create a custom control. Our goal is to create a rating control, where the user can vote via clicking on of several stars.


// --- D O N ' T    T O U C H   T H I S    S E C T I O N ---
toc::[]
// ---------------------------------------------------------


=== Difficulty
// Choose one of the below difficulties. You can just delete the ones you don't need.

üêî Normal üêî



=== Buzz-Words

// Write some buzz-words here. You can separate them by ", "

Control, TemplatedControl, custom Control, reusable Control, AvaloniaProperty, StyledProperty, DirectProperty, ReadonlyProperty, Style, ControlTheme


== Before we start

This sample assumes that you know the basics of Avalonia and the MVVM pattern. 

=== Some basics about Controls in Avalonia

Whenever we want to create a new control, we need to derive from a valid base class, which implements the needed interfaces and functions like styling, layout and user interaction. Below you can find a list of possible base-classes:

Control:: Use this as a base class if you want to render the control on your own and you want the control to look the same in every App (for example: `TextBlock`, `Image`).

TemplatedControl:: Use this control as your base class if you want to have a "lookless" control, which can be re-styled in any App. 

ContentControl:: This control inherits `TemplatedControl`, but adds the ability to place any content inside. 

TIP: You can also extend existing controls like `Button`, `TextBox` or `CheckBox`, if you want to use their functionality but adding your own logic on top. 

For more information about the types of controls please visit the https://docs.avaloniaui.net/docs/authoring-controls/types-of-control[[Documentation\]].

=== Properties

Avalonia has a property system which is responsible for storing and receiving the current value. The property system will take care of the styling, binding, validation and many more. There are three types of `AvaloniaProperties`. When you want to register your own property, you need to decide which property type is the right one for your use-case:

StyledProperty:: A `StyledProperty` is a property, which support styling and animation. use this type of property if you think the user of your control will most likely want to define this property in a `Style` (e.g.: `Foreground`, `Background`, `Margin`, ...). 

DirectProperty:: A `DirectProperty` is a property which can only be read and set in an actual control instance. Use this property if it's likely to be set individually on each instance (e.g.: `Text`, `Value`, ...) or if you need a read-only property (e.g:: `HasFocus`)

AttachedProperty:: An `AttachedProperty` is a property that can be set on any `Control`, even it doesn't define the property on it's own (e.g.: `Grid.Row`, `DockPanel.Dock`, ...)

If you want to learn more about `AvaloniaProperties` please visit the https://docs.avaloniaui.net/docs/authoring-controls/defining-properties[[Documentation\]]


=== The concept of the Rating-Control

Before you create any control, you should already have an idea which functions it should provide, how it should look like and how the user should interact with the control. Remember, the user interface is the door to your program. 

First of all we will write a list of requirements: 

- The developer should be able to define the number of stars. Ideally this should be reusable via `Styles`
- The user must be able to select their rating
- There must be a visual feedback showing the current rating
- The user should be able to interact with the mouse 
- The user should be able to interact via touch
- The user should be able to interact via keyboard
- The developer should be able to validate the input
- Any validation error should be shown to the user
- The visual appearance should be easy to adjust

NOTE: Items listed above containing the word _should_ mean are nice to have but the control will also work without this requirement fulfilled. On the other hand, requirements with the word *must* cannot be omitted, as the function of the control will not be given.

Now that we know the functions we want to serve, we can create a simple sketch of how the control should look like: 

image::_docs/sketch.png[Sketch]


== The Solution

=== Step 1: Create a new Project

In our sample we will create a new project using the `Avalonia MMVM Template`. We will place the sample App and the control together in the same project. In your real-world App you may want to create a https://learn.microsoft.com/en-us/dotnet/standard/class-library-overview[[`class library`-project\]] for your custom controls, so they can be reused in several Apps. 

=== Step 2: Add the RatingControl-class

In our project we create a new folder called `Controls`. inside this folder we will add a file called `RatingControl.cs`. Now we need to decide, which base-class we want to use. We want our control to be able to be re-styled by the developer, so we decide to base on `TemplatedControl`. 

[source,cs]
----
public class RatingControl : TemplatedControl 
{
}
----

=== Step 3: The number of stars

If we want to create a flexible control, we should not hardcode the number of stars. Instead, the developer should be able to define it inside a `Style`. Therefore we add a `StyledProperty` called `NumberOfStars`. The type of our property is `Integer`, the default value is `5`: 

[source,cs]
----
/// <summary>
/// Defines the <see cref="NumberOfStars"/> property.
/// </summary>
/// <remarks>
/// We define this property as a styled property, so you can set this property inside your style of the rating control. 
/// </remarks>
public static readonly StyledProperty<int> NumberOfStarsProperty =
    AvaloniaProperty.Register<RatingControl, int>(
        nameof(NumberOfStars),          // Sets the name of the property
        defaultValue: 5,                // The default value of this property
        coerce: CoerceNumberOfStars);   // Ensures that we always have a valid number of stars


/// <summary>
/// Gets or sets the number of available stars
/// </summary>
public int NumberOfStars
{
    get { return GetValue(NumberOfStarsProperty); }
    set { SetValue(NumberOfStarsProperty, value); }
}
----

The number of stars must not be smaller than one. A rating control without any star just makes no sense. We can ensure this by coercing the provided value:

[source,cs]
----
/// <summary>
/// This function will coerce the <see cref="NumberOfStars"/> property. The minimum allowed number is 1
/// </summary>
/// <param name="sender">the RatingControl-instance calling this method</param>
/// <param name="value">the value to coerce</param>
/// <returns>The coerced value</returns>
private static int CoerceNumberOfStars(IAvaloniaObject instance, int value)
{
    // the value should not be lower than 1.
    // Hint: You can also return Math.Max(1, value)
    if (value < 1)
    {
        return 1;
    }
    else
    {
        return value;
    }
}
----

== Related 

// Any related information or further readings goes here.



// --------------- Ascii-Doc Cheat-Sheet ------------------

// visit: https://asciidoc.org 
// visit: https://powerman.name/doc/asciidoc-compact

// VS-Code has a great Add-In for Ascii docs: https://github.com/asciidoctor/asciidoctor-vscode/